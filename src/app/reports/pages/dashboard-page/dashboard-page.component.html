<div class="p-4 bg-gray-50 min-h-screen">
  <div class="flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="text-3xl font-bold m-0 text-gray-800">Hola, {{ userName | titlecase }} üëã</h1>
      <p class="text-gray-500">Aqu√≠ tienes el resumen de tu negocio hoy.</p>
    </div>
    <div class="text-right">
      <p class="text-sm text-gray-400 m-0">{{ today | date:'fullDate' | titlecase }}</p>
    </div>
  </div>

  <div *ngIf="!stats" class="flex flex-column align-items-center justify-content-center p-5">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="mt-3 text-gray-500">Analizando datos...</p>
  </div>

  <div class="grid" *ngIf="stats">
    <div class="col-12 md:col-4">
      <mat-card class="h-full shadow-3 border-left-3 border-primary p-3 surface-card">
        <div class="flex align-items-center">
          <div class="bg-blue-100 border-circle p-3 flex align-items-center justify-content-center mr-3">
            <mat-icon class="text-primary text-3xl" style="width:30px; height:30px; font-size:30px">attach_money</mat-icon>
          </div>
          <div>
            <div class="text-gray-500 font-medium text-sm">Ventas de Hoy</div>
            <div class="text-900 font-bold text-3xl mt-1">{{ stats.sales_today_amount | currency }}</div>
            <div class="text-green-500 text-sm font-medium mt-1">
              <mat-icon class="text-xs align-middle" style="font-size: 12px; height: 12px; width: 12px;">trending_up</mat-icon> 
              Ingresos netos
            </div>
          </div>
        </div>
      </mat-card>
    </div>

    <div class="col-12 md:col-4">
      <mat-card class="h-full shadow-3 border-left-3 border-indigo-500 p-3 surface-card">
         <div class="flex align-items-center">
          <div class="bg-indigo-100 border-circle p-3 flex align-items-center justify-content-center mr-3">
            <mat-icon class="text-indigo-600 text-3xl" style="width:30px; height:30px; font-size:30px">receipt_long</mat-icon>
          </div>
          <div>
            <div class="text-gray-500 font-medium text-sm">Transacciones</div>
            <div class="text-900 font-bold text-3xl mt-1">{{ stats.sales_today_count }}</div>
            <div class="text-gray-400 text-sm font-medium mt-1">Tickets generados hoy</div>
          </div>
        </div>
      </mat-card>
    </div>

    <div class="col-12 md:col-4">
      <mat-card class="h-full shadow-3 border-left-3 p-3 surface-card" 
                [ngClass]="{'border-red-500': stats.low_stock_products > 0, 'border-green-500': stats.low_stock_products === 0}">
         <div class="flex align-items-center">
          <div class="border-circle p-3 flex align-items-center justify-content-center mr-3"
               [ngClass]="{'bg-red-100': stats.low_stock_products > 0, 'bg-green-100': stats.low_stock_products === 0}">
            <mat-icon class="text-3xl" [ngClass]="{'text-red-600': stats.low_stock_products > 0, 'text-green-600': stats.low_stock_products === 0}"
                      style="width:30px; height:30px; font-size:30px">
                {{ stats.low_stock_products > 0 ? 'warning' : 'check_circle' }}
            </mat-icon>
          </div>
          <div>
            <div class="text-gray-500 font-medium text-sm">Estado de Inventario</div>
            <div class="text-900 font-bold text-3xl mt-1">{{ stats.low_stock_products }}</div>
            <div class="text-sm font-medium mt-1" [ngClass]="{'text-red-500': stats.low_stock_products > 0, 'text-green-500': stats.low_stock_products === 0}">
              {{ stats.low_stock_products > 0 ? 'Productos bajos en stock' : 'Inventario saludable' }}
            </div>
          </div>
        </div>
      </mat-card>
    </div>

    <div class="col-12 md:col-4 mt-3">
      <mat-card class="h-full shadow-2">
        <mat-card-header>
          <mat-card-title>Accesos R√°pidos</mat-card-title>
        </mat-card-header>
        <mat-card-content class="flex flex-column gap-3 mt-3">
          <button mat-raised-button color="primary" class="p-4 text-lg" routerLink="/sales/pos" style="height: 60px;">
            <mat-icon class="mr-2">point_of_sale</mat-icon> NUEVA VENTA
          </button>
          <button mat-stroked-button color="accent" class="p-3" routerLink="/inventory/new">
            <mat-icon class="mr-2">add_box</mat-icon> Agregar Producto
          </button>
          <button mat-stroked-button class="p-3" routerLink="/clients/new">
            <mat-icon class="mr-2">person_add</mat-icon> Registrar Cliente
          </button>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="col-12 md:col-8 mt-3">
      <mat-card class="h-full shadow-2">
        <mat-card-header class="flex justify-content-between align-items-center">
          <mat-card-title>üèÜ Top 5 M√°s Vendidos</mat-card-title>
          <button mat-button color="primary" routerLink="/reports/sales">Ver reporte completo</button>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-list>
            <div *ngIf="topProducts.length === 0" class="p-5 text-center text-gray-400">
                <mat-icon class="text-5xl mb-2">bar_chart</mat-icon>
                <p>A√∫n no hay ventas registradas.</p>
            </div>
            <mat-list-item *ngFor="let p of topProducts; let i = index" class="hover:bg-gray-50">
                <div matListItemIcon class="font-bold text-xl mr-3" 
                     [ngClass]="{'text-yellow-500': i===0, 'text-gray-400': i>0}">
                     #{{ i + 1 }}
                </div>
                <div matListItemTitle class="font-bold">{{ p.product__name }}</div>
                <div matListItemLine class="text-gray-500">{{ p.total_qty }} unidades vendidas</div>
                <mat-icon matListItemMeta class="text-green-500">trending_up</mat-icon>
            </mat-list-item>
        </mat-list>
      </mat-card>
    </div>

  </div>
</div>
