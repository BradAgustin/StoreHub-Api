<div class="grid p-3">
  <div class="col-12 md:col-7">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Catálogo de Venta</mat-card-title>
        <mat-card-subtitle>Solo productos activos</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field class="w-full mt-2">
          <mat-label>Buscar producto...</mat-label>
          <input matInput [(ngModel)]="searchTerm" (keyup)="filterProducts()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <div class="grid mt-2" style="max-height: 500px; overflow-y: auto;">
          <div *ngFor="let product of filteredProducts" class="col-6 sm:col-4" (click)="addToCart(product)">
            <mat-card class="cursor-pointer hover:shadow-4 border-1 border-gray-200 h-full">
              <div class="p-3 text-center">
                <div class="font-bold mb-1">{{ product.name }}</div>
                <div class="text-xs text-gray-500 mb-1">{{ product.sku }}</div>
                <div class="text-primary text-xl">{{ product.price | currency }}</div>
                
                <div class="text-sm mt-1" [ngClass]="{'text-red-500 font-bold': product.stock < 5, 'text-green-600': product.stock >= 5}">
                  Stock: {{ product.stock }}
                </div>
              </div>
            </mat-card>
          </div>
          
          <div *ngIf="filteredProducts.length === 0" class="col-12 text-center p-4 text-gray-500">
            No se encontraron productos activos.
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="col-12 md:col-5">
    <mat-card class="h-full">
      <mat-card-header><mat-card-title>Ticket</mat-card-title></mat-card-header>
      <mat-card-content>
        <mat-form-field class="w-full mt-2">
          <mat-label>Cliente</mat-label>
          <mat-select [(ngModel)]="selectedClient">
            <mat-option [value]="null">Público General</mat-option>
            <mat-option *ngFor="let c of clients" [value]="c.id">{{ c.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-list style="max-height: 400px; overflow-y: auto;">
          <mat-list-item *ngFor="let item of cart">
            <div matListItemTitle class="font-bold">{{ item.productName }}</div>
            <div matListItemLine>
               {{ item.price | currency }} x 
               <button mat-icon-button small (click)="updateQty(item, -1)"><mat-icon>remove</mat-icon></button>
               {{ item.quantity }}
               <button mat-icon-button small (click)="updateQty(item, 1)"><mat-icon>add</mat-icon></button>
            </div>
            <span matListItemMeta>{{ item.subtotal | currency }}</span>
            <button mat-icon-button matListItemMeta (click)="removeFromCart(item)" color="warn"><mat-icon>delete</mat-icon></button>
          </mat-list-item>
        </mat-list>
        <mat-divider></mat-divider>
        <div class="flex justify-content-between align-items-center mt-4">
          <span class="text-2xl font-bold">Total:</span>
          <span class="text-3xl text-primary font-bold">{{ total | currency }}</span>
        </div>
      </mat-card-content>
      <mat-card-actions align="end" class="p-3">
        <button mat-stroked-button color="warn" (click)="cart=[]; calculateTotal()">Cancelar</button>
        <button mat-flat-button color="primary" [disabled]="cart.length === 0" (click)="openConfirmModal()">
          <mat-icon>receipt</mat-icon> COBRAR
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
